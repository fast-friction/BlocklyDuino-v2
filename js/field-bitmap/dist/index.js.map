{"version":3,"file":"index.js","mappings":"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","sources":["webpack://@blockly/field-bitmap/webpack/universalModuleDefinition","webpack://@blockly/field-bitmap/external umd {\"root\":\"Blockly\",\"commonjs\":\"blockly/core\",\"commonjs2\":\"blockly/core\",\"amd\":\"blockly/core\"}","webpack://@blockly/field-bitmap/webpack/bootstrap","webpack://@blockly/field-bitmap/webpack/runtime/define property getters","webpack://@blockly/field-bitmap/webpack/runtime/hasOwnProperty shorthand","webpack://@blockly/field-bitmap/webpack/runtime/make namespace object","webpack://@blockly/field-bitmap/./src/field-bitmap.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"blockly/core\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"blockly/core\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"blockly/core\")) : factory(root[\"Blockly\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, (__WEBPACK_EXTERNAL_MODULE__370__) => {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__370__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as Blockly from 'blockly/core';\n\nBlockly.Msg['BUTTON_LABEL_RANDOMIZE'] = 'Randomize';\nBlockly.Msg['BUTTON_LABEL_CLEAR'] = 'Clear';\n\nexport const DEFAULT_HEIGHT = 5;\nexport const DEFAULT_WIDTH = 5;\nconst DEFAULT_PIXEL_SIZE = 15;\nconst DEFAULT_PIXEL_COLOURS: PixelColours = {\n  empty: '#fff',\n  filled: '#363d80',\n};\nconst DEFAULT_BUTTONS: Buttons = {\n  randomize: true,\n  clear: true,\n};\n/**\n * Field for inputting a small bitmap image.\n * Includes a grid of clickable pixels that's exported as a bitmap.\n */\nexport class FieldBitmap extends Blockly.Field<number[][]> {\n  private initialValue: number[][] | null = null;\n  private imgHeight: number;\n  private imgWidth: number;\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   */\n  private boundEvents: Blockly.browserEvents.Data[] = [];\n  /** References to UI elements */\n  private editorPixels: HTMLElement[][] | null = null;\n  private blockDisplayPixels: SVGElement[][] | null = null;\n  /** Stateful variables */\n  private pointerIsDown = false;\n  private valToPaintWith?: number;\n  buttonOptions: Buttons;\n  pixelSize: number;\n  pixelColours: {empty: string; filled: string};\n  fieldHeight?: number;\n\n  /**\n   * Constructor for the bitmap field.\n   *\n   * @param value 2D rectangular array of 1s and 0s.\n   * @param validator A function that is called to validate.\n   * @param config Config A map of options used to configure the field.\n   */\n  constructor(\n    value: number[][] | typeof Blockly.Field.SKIP_SETUP,\n    validator?: Blockly.FieldValidator<number[][]>,\n    config?: FieldBitmapFromJsonConfig,\n  ) {\n    super(value, validator, config);\n\n    this.SERIALIZABLE = true;\n    this.buttonOptions = {...DEFAULT_BUTTONS, ...config?.buttons};\n    this.pixelColours = {...DEFAULT_PIXEL_COLOURS, ...config?.colours};\n\n    // Configure value, height, and width\n    const currentValue = this.getValue();\n    if (currentValue !== null) {\n      this.imgHeight = currentValue.length;\n      this.imgWidth = currentValue[0].length || 0;\n    } else {\n      this.imgHeight = config?.height ?? DEFAULT_HEIGHT;\n      this.imgWidth = config?.width ?? DEFAULT_WIDTH;\n      // Set a default empty value\n      this.setValue(this.getEmptyArray());\n    }\n    this.fieldHeight = config?.fieldHeight;\n    if (this.fieldHeight) {\n      this.pixelSize = this.fieldHeight / this.imgHeight;\n    } else {\n      this.pixelSize = DEFAULT_PIXEL_SIZE;\n    }\n  }\n\n  /**\n   * Constructs a FieldBitmap from a JSON arg object.\n   *\n   * @param options A JSON object with options.\n   * @returns The new field instance.\n   */\n  static fromJson(options: FieldBitmapFromJsonConfig) {\n    // `this` might be a subclass of FieldBitmap if that class doesn't override the static fromJson method.\n    return new this(\n      options.value ?? Blockly.Field.SKIP_SETUP,\n      undefined,\n      options,\n    );\n  }\n\n  /**\n   * Returns the width of the image in pixels.\n   *\n   * @returns The width in pixels.\n   */\n  getImageWidth() {\n    return this.imgWidth;\n  }\n\n  /**\n   * Returns the height of the image in pixels.\n   *\n   * @returns The height in pixels.\n   */\n  getImageHeight() {\n    return this.imgHeight;\n  }\n\n  /**\n   * Validates that a new value meets the requirements for a valid bitmap array.\n   *\n   * @param newValue The new value to be tested.\n   * @returns The new value if it's valid, or null.\n   */\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  protected override doClassValidation_(\n    newValue: number[][],\n  ): number[][] | null | undefined;\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  protected override doClassValidation_(\n    newValue?: number[][],\n  ): number[][] | null;\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  protected override doClassValidation_(\n    newValue?: number[][],\n  ): number[][] | null | undefined {\n    if (!newValue) {\n      return null;\n    }\n    // Check if the new value is an array\n    if (!Array.isArray(newValue)) {\n      return null;\n    }\n    const newHeight = newValue.length;\n    // The empty list is not an acceptable bitmap\n    if (newHeight == 0) {\n      return null;\n    }\n\n    // Check that the width matches the existing width of the image if it\n    // already has a value.\n    const newWidth = newValue[0].length;\n    for (const row of newValue) {\n      if (!Array.isArray(row)) {\n        return null;\n      }\n      if (row.length !== newWidth) {\n        return null;\n      }\n    }\n\n    // Check if all contents of the arrays are either 0 or 1\n    for (const row of newValue) {\n      for (const cell of row) {\n        if (cell !== 0 && cell !== 1) {\n          return null;\n        }\n      }\n    }\n    return newValue;\n  }\n\n  /**\n   * Called when a new value has been validated and is about to be set.\n   *\n   * @param newValue The value that's about to be set.\n   */\n  // eslint-disable-next-line\n  protected override doValueUpdate_(newValue: number[][]) {\n    super.doValueUpdate_(newValue);\n    if (newValue) {\n      this.imgHeight = newValue.length;\n      this.imgWidth = newValue[0] ? newValue[0].length : 0;\n      // If the field height is static, adjust the pixel size to fit.\n      if (this.fieldHeight) {\n        this.pixelSize = this.fieldHeight / this.imgHeight;\n      } else {\n        this.pixelSize = DEFAULT_PIXEL_SIZE;\n      }\n    }\n  }\n\n  /**\n   * Show the bitmap editor dialog.\n   *\n   * @param e Optional mouse event that triggered the field to open, or\n   *    undefined if triggered programmatically.\n   */\n  // eslint-disable-next-line\n  protected override showEditor_(e?: Event) {\n    const editor = this.dropdownCreate();\n    Blockly.DropDownDiv.getContentDiv().appendChild(editor);\n    Blockly.DropDownDiv.showPositionedByField(\n      this,\n      this.dropdownDispose.bind(this),\n    );\n  }\n\n  /**\n   * Updates the block display and editor dropdown when the field re-renders.\n   */\n  // eslint-disable-next-line\n  protected override render_() {\n    super.render_();\n\n    if (!this.getValue()) {\n      return;\n    }\n\n    if (this.blockDisplayPixels) {\n      this.forAllCells((r, c) => {\n        const pixel = this.getPixel(r, c);\n\n        if (this.blockDisplayPixels) {\n          this.blockDisplayPixels[r][c].style.fill = pixel\n            ? this.pixelColours.filled\n            : this.pixelColours.empty;\n        }\n        if (this.editorPixels) {\n          this.editorPixels[r][c].style.background = pixel\n            ? this.pixelColours.filled\n            : this.pixelColours.empty;\n        }\n      });\n    }\n  }\n\n  /**\n   * Determines whether the field is editable.\n   *\n   * @returns True since it is always editable.\n   */\n  override updateEditable() {\n    const editable = super.updateEditable();\n    // Blockly.Field's implementation sets these classes as appropriate, but\n    // since this field has no text they just mess up the rendering of the grid\n    // lines.\n    const svgRoot = this.getSvgRoot();\n    if (svgRoot) {\n      Blockly.utils.dom.removeClass(svgRoot, 'blocklyNonEditableField');\n      Blockly.utils.dom.removeClass(svgRoot, 'blocklyEditableField');\n    }\n    return editable;\n  }\n\n  /**\n   * Gets the rectangle built out of dimensions matching SVG's <g> element.\n   *\n   * @returns The newly created rectangle of same size as the SVG element.\n   */\n  override getScaledBBox() {\n    const boundingBox = this.getSvgRoot()?.getBoundingClientRect();\n    if (!boundingBox) {\n      throw new Error('Tried to retrieve a bounding box without a rect');\n    }\n    return new Blockly.utils.Rect(\n      boundingBox.top,\n      boundingBox.bottom,\n      boundingBox.left,\n      boundingBox.right,\n    );\n  }\n\n  /**\n   * Creates the bitmap editor and add event listeners.\n   *\n   * @returns The newly created dropdown menu.\n   */\n  private dropdownCreate() {\n    const dropdownEditor = this.createElementWithClassname(\n      'div',\n      'dropdownEditor',\n    );\n    if (this.buttonOptions.randomize || this.buttonOptions.clear) {\n      dropdownEditor.classList.add('has-buttons');\n    }\n    const pixelContainer = this.createElementWithClassname(\n      'div',\n      'pixelContainer',\n    );\n    dropdownEditor.appendChild(pixelContainer);\n\n    // This prevents the normal max-height from adding a scroll bar for large images.\n    Blockly.DropDownDiv.getContentDiv().classList.add('contains-bitmap-editor');\n\n    this.bindEvent(dropdownEditor, 'pointermove', this.onPointerMove);\n    this.bindEvent(dropdownEditor, 'pointerup', this.onPointerEnd);\n    this.bindEvent(dropdownEditor, 'pointerleave', this.onPointerEnd);\n    this.bindEvent(dropdownEditor, 'pointerdown', this.onPointerStart);\n    this.bindEvent(dropdownEditor, 'pointercancel', this.onPointerEnd);\n    // Stop the browser from handling touch events and cancelling the event.\n    this.bindEvent(dropdownEditor, 'touchmove', (e: Event) => {\n      e.preventDefault();\n    });\n\n    this.editorPixels = [];\n    for (let r = 0; r < this.imgHeight; r++) {\n      this.editorPixels.push([]);\n      const rowDiv = this.createElementWithClassname('div', 'pixelRow');\n      for (let c = 0; c < this.imgWidth; c++) {\n        // Add the button to the UI and save a reference to it\n        const button = this.createElementWithClassname('div', 'pixelButton');\n        this.editorPixels[r].push(button);\n        rowDiv.appendChild(button);\n\n        // Load the current pixel colour\n        const isOn = this.getPixel(r, c);\n        button.style.background = isOn\n          ? this.pixelColours.filled\n          : this.pixelColours.empty;\n\n        // Set the custom data attributes for row and column indices\n        button.setAttribute('data-row', r.toString());\n        button.setAttribute('data-col', c.toString());\n      }\n      pixelContainer.appendChild(rowDiv);\n    }\n\n    // Add control buttons below the pixel grid\n    if (this.buttonOptions.randomize) {\n      this.addControlButton(\n        dropdownEditor,\n        Blockly.Msg['BUTTON_LABEL_RANDOMIZE'],\n        this.randomizePixels,\n      );\n    }\n    if (this.buttonOptions.clear) {\n      this.addControlButton(\n        dropdownEditor,\n        Blockly.Msg['BUTTON_LABEL_CLEAR'],\n        this.clearPixels,\n      );\n    }\n\n    if (this.blockDisplayPixels) {\n      this.forAllCells((r, c) => {\n        const pixel = this.getPixel(r, c);\n        if (this.editorPixels) {\n          this.editorPixels[r][c].style.background = pixel\n            ? this.pixelColours.filled\n            : this.pixelColours.empty;\n        }\n      });\n    }\n\n    // Store the initial value at the start of the edit.\n    this.initialValue = this.getValue();\n\n    return dropdownEditor;\n  }\n\n  /**\n   * Initializes the on-block display.\n   */\n  override initView() {\n    this.blockDisplayPixels = [];\n    for (let r = 0; r < this.imgHeight; r++) {\n      const row = [];\n      for (let c = 0; c < this.imgWidth; c++) {\n        const square = Blockly.utils.dom.createSvgElement(\n          'rect',\n          {\n            x: c * this.pixelSize,\n            y: r * this.pixelSize,\n            width: this.pixelSize,\n            height: this.pixelSize,\n            fill: this.pixelColours.empty,\n            fill_opacity: 1, // eslint-disable-line\n          },\n          this.getSvgRoot(),\n        );\n        row.push(square);\n      }\n      this.blockDisplayPixels.push(row);\n    }\n  }\n\n  /**\n   * Updates the size of the block based on the size of the underlying image.\n   */\n  // eslint-disable-next-line\n  protected override updateSize_() {\n    {\n      const newWidth = this.pixelSize * this.imgWidth;\n      const newHeight = this.pixelSize * this.imgHeight;\n      if (this.borderRect_) {\n        this.borderRect_.setAttribute('width', String(newWidth));\n        this.borderRect_.setAttribute('height', String(newHeight));\n      }\n\n      this.size_.width = newWidth;\n      this.size_.height = newHeight;\n    }\n  }\n\n  /**\n   * Create control button.\n   *\n   * @param parent Parent HTML element to which control button will be added.\n   * @param buttonText Text of the control button.\n   * @param onClick Callback that will be attached to the control button.\n   */\n  private addControlButton(\n    parent: HTMLElement,\n    buttonText: string,\n    onClick: () => void,\n  ) {\n    const button = this.createElementWithClassname('button', 'controlButton');\n    button.innerText = buttonText;\n    parent.appendChild(button);\n    this.bindEvent(button, 'click', onClick);\n  }\n\n  /**\n   * Disposes of events belonging to the bitmap editor.\n   */\n  private dropdownDispose() {\n    if (\n      this.getSourceBlock() &&\n      this.initialValue !== null &&\n      this.initialValue !== this.getValue()\n    ) {\n      Blockly.Events.fire(\n        new (Blockly.Events.get(Blockly.Events.BLOCK_CHANGE))(\n          this.sourceBlock_,\n          'field',\n          this.name || null,\n          this.initialValue,\n          this.getValue(),\n        ),\n      );\n    }\n\n    for (const event of this.boundEvents) {\n      Blockly.browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n    this.editorPixels = null;\n    // Set this.initialValue back to null.\n    this.initialValue = null;\n\n    Blockly.DropDownDiv.getContentDiv().classList.remove(\n      'contains-bitmap-editor',\n    );\n  }\n\n  /**\n   * Constructs an array of zeros with the specified width and height.\n   *\n   * @returns The new value.\n   */\n  private getEmptyArray(): number[][] {\n    const newVal: number[][] = [];\n    for (let r = 0; r < this.imgHeight; r++) {\n      newVal.push([]);\n      for (let c = 0; c < this.imgWidth; c++) {\n        newVal[r].push(0);\n      }\n    }\n    return newVal;\n  }\n\n  /**\n   * Checks if a down event is on a pixel in this editor and if it is starts an\n   * edit gesture.\n   *\n   * @param e The down event.\n   */\n  private onPointerStart(e: PointerEvent) {\n    const currentElement = document.elementFromPoint(e.clientX, e.clientY);\n    const rowIndex = currentElement?.getAttribute('data-row');\n    const colIndex = currentElement?.getAttribute('data-col');\n    if (rowIndex && colIndex) {\n      this.onPointerDownInPixel(parseInt(rowIndex), parseInt(colIndex));\n      this.pointerIsDown = true;\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Updates the editor if we're in an edit gesture and the pointer is over a\n   * pixel.\n   *\n   * @param e The move event.\n   */\n  private onPointerMove(e: PointerEvent) {\n    if (!this.pointerIsDown) {\n      return;\n    }\n    const currentElement = document.elementFromPoint(e.clientX, e.clientY);\n    const rowIndex = currentElement?.getAttribute('data-row');\n    const colIndex = currentElement?.getAttribute('data-col');\n    if (rowIndex && colIndex) {\n      this.updatePixelValue(parseInt(rowIndex), parseInt(colIndex));\n    }\n    e.preventDefault();\n  }\n\n  /**\n   * Starts an interaction with the bitmap dropdown when there's a pointerdown\n   * within one of the pixels in the editor.\n   *\n   * @param r Row number of grid.\n   * @param c Column number of grid.\n   */\n  private onPointerDownInPixel(r: number, c: number) {\n    // Toggle that pixel to the opposite of its value\n    const newPixelValue = 1 - this.getPixel(r, c);\n    this.setPixel(r, c, newPixelValue);\n    this.pointerIsDown = true;\n    this.valToPaintWith = newPixelValue;\n  }\n\n  /**\n   * Sets the specified pixel in the editor to the current value being painted.\n   *\n   * @param r Row number of grid.\n   * @param c Column number of grid.\n   */\n  private updatePixelValue(r: number, c: number) {\n    if (\n      this.valToPaintWith !== undefined &&\n      this.getPixel(r, c) !== this.valToPaintWith\n    ) {\n      this.setPixel(r, c, this.valToPaintWith);\n    }\n  }\n\n  /**\n   * Resets pointer state (e.g. After either a pointerup event or if the\n   * gesture is canceled).\n   */\n  private onPointerEnd() {\n    this.pointerIsDown = false;\n    this.valToPaintWith = undefined;\n  }\n\n  /**\n   * Sets all the pixels in the image to a random value.\n   */\n  private randomizePixels() {\n    const getRandBinary = () => Math.floor(Math.random() * 2);\n    this.forAllCells((r, c) => {\n      this.setPixel(r, c, getRandBinary());\n    });\n  }\n\n  /**\n   * Sets all the pixels to 0.\n   */\n  private clearPixels() {\n    const cleared = this.getEmptyArray();\n    this.fireIntermediateChangeEvent(cleared);\n    this.setValue(cleared, false);\n  }\n\n  /**\n   * Sets the value of a particular pixel.\n   *\n   * @param r Row number of grid.\n   * @param c Column number of grid.\n   * @param newValue Value of the pixel.\n   */\n  private setPixel(r: number, c: number, newValue: number) {\n    const newGrid = JSON.parse(JSON.stringify(this.getValue()));\n    newGrid[r][c] = newValue;\n    this.fireIntermediateChangeEvent(newGrid);\n    this.setValue(newGrid, false);\n  }\n\n  private getPixel(row: number, column: number): number {\n    const value = this.getValue();\n    if (!value) {\n      throw new Error(\n        'Attempted to retrieve a pixel value when no value is set',\n      );\n    }\n\n    return value[row][column];\n  }\n\n  /**\n   * Calls a given function for all cells in the image, with the cell\n   * coordinates as the arguments.\n   *\n   * @param func A function to be applied.\n   */\n  private forAllCells(func: (row: number, col: number) => void) {\n    for (let r = 0; r < this.imgHeight; r++) {\n      for (let c = 0; c < this.imgWidth; c++) {\n        func(r, c);\n      }\n    }\n  }\n\n  /**\n   * Creates a new element with the specified type and class.\n   *\n   * @param elementType Type of html element.\n   * @param className ClassName of html element.\n   * @returns The created element.\n   */\n  private createElementWithClassname(elementType: string, className: string) {\n    const newElt = document.createElement(elementType);\n    newElt.className = className;\n    return newElt;\n  }\n\n  /**\n   * Binds an event listener to the specified element.\n   *\n   * @param element Specified element.\n   * @param eventName Name of the event to bind.\n   * @param callback Function to be called on specified event.\n   */\n  private bindEvent(\n    element: HTMLElement,\n    eventName: string,\n    callback: (e: PointerEvent) => void,\n  ) {\n    this.boundEvents.push(\n      Blockly.browserEvents.bind(element, eventName, this, callback),\n    );\n  }\n\n  private fireIntermediateChangeEvent(newValue: number[][]) {\n    if (this.getSourceBlock()) {\n      Blockly.Events.fire(\n        new (Blockly.Events.get(\n          Blockly.Events.BLOCK_FIELD_INTERMEDIATE_CHANGE,\n        ))(this.getSourceBlock(), this.name || null, this.getValue(), newValue),\n      );\n    }\n  }\n}\n\ninterface Buttons {\n  readonly randomize: boolean;\n  readonly clear: boolean;\n}\ninterface PixelColours {\n  readonly empty: string;\n  readonly filled: string;\n}\n\nexport interface FieldBitmapFromJsonConfig extends Blockly.FieldConfig {\n  value?: number[][];\n  width?: number;\n  height?: number;\n  buttons?: Buttons;\n  fieldHeight?: number;\n  colours?: PixelColours;\n}\n\nBlockly.fieldRegistry.register('field_bitmap', FieldBitmap);\n\n/**\n * CSS for bitmap field.\n */\nBlockly.Css.register(`\n.dropdownEditor {\n  align-items: center;\n  flex-direction: column;\n  display: flex;\n  justify-content: center;\n}\n.dropdownEditor.has-buttons {\n  margin-bottom: 20px;\n}\n.pixelContainer {\n  margin: 20px;\n}\n.pixelRow {\n  display: flex;\n  flex-direction: row;\n  padding: 0;\n  margin: 0;\n  height: ${DEFAULT_PIXEL_SIZE}\n}\n.pixelButton {\n  width: ${DEFAULT_PIXEL_SIZE}px;\n  height: ${DEFAULT_PIXEL_SIZE}px;\n  border: 1px solid #000;\n}\n.pixelDisplay {\n  white-space:pre-wrap;\n}\n.controlButton {\n  margin: 5px 0;\n}\n.blocklyDropDownContent.contains-bitmap-editor {\n  max-height: none;\n}\n`);\n"],"names":["root","factory","exports","module","require","define","amd","a","i","this","__WEBPACK_EXTERNAL_MODULE__370__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","DEFAULT_HEIGHT","DEFAULT_WIDTH","DEFAULT_PIXEL_COLOURS","empty","filled","DEFAULT_BUTTONS","randomize","clear","FieldBitmap","constructor","validator","config","super","initialValue","boundEvents","editorPixels","blockDisplayPixels","pointerIsDown","SERIALIZABLE","buttonOptions","buttons","pixelColours","colours","currentValue","getValue","imgHeight","length","imgWidth","height","width","setValue","getEmptyArray","fieldHeight","pixelSize","fromJson","options","SKIP_SETUP","getImageWidth","getImageHeight","doClassValidation_","newValue","Array","isArray","newWidth","row","cell","doValueUpdate_","showEditor_","e","editor","dropdownCreate","getContentDiv","appendChild","showPositionedByField","dropdownDispose","bind","render_","forAllCells","c","pixel","getPixel","style","fill","background","updateEditable","editable","svgRoot","getSvgRoot","dom","removeClass","getScaledBBox","boundingBox","getBoundingClientRect","Error","Rect","top","bottom","left","right","dropdownEditor","createElementWithClassname","classList","add","pixelContainer","bindEvent","onPointerMove","onPointerEnd","onPointerStart","preventDefault","push","rowDiv","button","isOn","setAttribute","toString","addControlButton","randomizePixels","clearPixels","initView","square","createSvgElement","x","y","fill_opacity","updateSize_","newHeight","borderRect_","String","size_","parent","buttonText","onClick","innerText","getSourceBlock","fire","BLOCK_CHANGE","sourceBlock_","name","event","unbind","remove","newVal","currentElement","document","elementFromPoint","clientX","clientY","rowIndex","getAttribute","colIndex","onPointerDownInPixel","parseInt","updatePixelValue","newPixelValue","setPixel","valToPaintWith","Math","floor","random","cleared","fireIntermediateChangeEvent","newGrid","JSON","parse","stringify","column","func","elementType","className","newElt","createElement","element","eventName","callback","BLOCK_FIELD_INTERMEDIATE_CHANGE","register"],"sourceRoot":""}